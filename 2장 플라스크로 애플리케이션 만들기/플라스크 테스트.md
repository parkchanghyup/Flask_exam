# 플라스크 테스트
개발할 때 테스트 코드를 함께 개발하는 `TDD(test-driven development)`는 소프트 개발에서 빠지지 않고 등장하는 프로세스 중 하나이다.  
테스트 코드를 작성하여 사전에 버그를 방지하고 소프트웨어 품질을 높이는 데 도움이 된다. 
테스트 종류로는 `단위 테스트(unit test)`, `기능 테스트(functional test)`, `통합 테스트(integration test)`등이 있고 플라스크에서는 기본적으로 유닛 테스트와 기능 테스트를 예로 들을 수 있다.
- 단위 테스트 : 클래스나 함수 단위를 테스트한다.
- 기능 테스트 : API 요청 시 올바른 값 혹은 잘못된 값에 대해 정확히 응답하는지 텍스트한다.
- 통합 테스트 : 서비스 측면에서 테스트한다.

## 기능 테스트 
아래와 같은 API가 있을때, 리턴 값만 봐서는 어떻게 결괏값이 오는지 알기 어렵다. API를 호출해보자.
```python
apps/controllers/index/controllers.py
@app.route('/', methods = ['GET'])
def index():
    return ok('Index')
```
위 코드는 {'code' : 20000, 'data': 'index'}를 리턴한다. 변수가 없어 테스트 코드는 단순하다.   

이제 테스트 코드를 살펴보자.  
```python
# -*- coding: utf-8 -*-
import json
import unittest2

from apps.controllers.router import app


class Test(unittest2.TestCase):
    def setUp(self):
        self.app = app.test_client()

    def tearDown(self):
        pass

    def test_get_index(self):
        result = self.app.get('/')
        self.assertEqual(result.status_code, 200)
        data = json.loads(result.data.decode('utf-8'))
        self.assertEqual(data['data'], 'Index')


if __name__ == '__main__':
    unittest2.main()
```
TstCase를 상속받아 setUp()m teardown() 등과 같은 함수를 사용할 수 있다. 또한 `test_테스트명`으로 테스트 선언이 가능해진다. `test_테스트명`으로 선언한 함수들에 대해 테스트를 진행한다.

```python
class Test(unittest2.TestCase):
```
플라스크에서 API를 테스트하려면 app을 선언해야 한다. 이때 다음과 같이 선언한다.

```python
def setUp(self):
    self.app = app.test_client()
```
TestCase 객체는 assert() 함수들을 제공하는데 여기서는 assertEqual() 함수를 사용해서 값을 검증했다.

```python
def test_get_index(self): 
    result = self.app.get('/')
    self.assertEqual(result.status_code, 200)
    data = json.loads(result.data.decode('utf-8'))
    self.aseertEqual(data['data'], 'Index')
```
API를 호출해서 HTTP STATUS 값이 200인지 확인한다. JSON 결괏값을 불러와 데이터와 일치하는지 비교한다.
```python
result = self.app.get('/')
self.assertEqual(result.stauts_code, 200)
```
테스트 코드를 추적해 한 번에 실행해주는 로직이다. python manage.py test로 실행한다. 

```python
data = json.loads(result.data.decode('utf-8'))
self.assertEqual(data['data'], "index")


@manager.command
class Test(unittest2.TestCase):
    """test code"""
    JsonConfig.set_data('TESTING', True)

    loader = unittest2.TestLoader()
    start_dir = '{0}/apps'.format(Config.ROOT_DIR)
    suit = loader.discover(start_dir) 

    runner = uniitest2.TextTestRunner()
    r = runner.run(suite)

    JsonConfig.set_data('TESTING', False)

    if r.wasSuccessful():
        print('success')
    else :
        print('fail')
        exit(1)
```
python manage.py test를 싱행하면 apps/test 폴더에 있는 모든 테스트케이스를 실행하게 된다. 테스트 코드를 통과했다면 다음과 같은 결과가 출력된다.


```
(venv) /Users/harvey/flask>python manage.py test
. . . . . . .
-----------------------------------------------------
Ran 9 tests in 1.218s

OK
success
```
